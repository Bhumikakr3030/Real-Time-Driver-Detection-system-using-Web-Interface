<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Drowsiness Detection System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a3a, #0d1b2a);
            color: #e0e1dd;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid #415a77;
        }

        h1 {
            font-size: 2.5rem;
            color: #e0e1dd;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #778da9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(26, 42, 58, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border: 1px solid #415a77;
        }

        .panel-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #e0e1dd;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title i {
            color: #778da9;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: #0d1b2a;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .video-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .upload-section {
            margin-top: 20px;
        }

        .upload-tabs {
            display: flex;
            margin-bottom: 15px;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 8px;
            padding: 5px;
        }

        .upload-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .upload-tab.active {
            background: #415a77;
            font-weight: bold;
        }

        .upload-container {
            padding: 20px;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 10px;
            border: 2px dashed #415a77;
            text-align: center;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .upload-container.drag-over {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .upload-btn {
            display: inline-block;
            padding: 12px 25px;
            background: #415a77;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
        }

        .upload-btn:hover {
            background: #4caf50;
            transform: translateY(-2px);
        }

        .upload-text {
            margin: 10px 0;
            color: #778da9;
        }

        .uploaded-media {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .video-player {
            width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .video-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }

        .video-control-btn {
            padding: 8px 15px;
            background: #415a77;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-control-btn:hover {
            background: #4caf50;
        }

        .analysis-results {
            margin-top: 15px;
            padding: 15px;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 8px;
            display: none;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #415a77;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            color: #778da9;
        }

        .result-value {
            font-weight: bold;
        }

        .video-analysis-progress {
            width: 100%;
            height: 6px;
            background: #415a77;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
            display: none;
        }

        .video-progress-bar {
            height: 100%;
            background: #4caf50;
            width: 0%;
            transition: width 0.3s ease;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .status {
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .status-awake {
            background: rgba(46, 125, 50, 0.3);
            color: #81c784;
            border: 2px solid #4caf50;
        }

        .status-drowsy {
            background: rgba(198, 40, 40, 0.3);
            color: #ff8a80;
            border: 2px solid #f44336;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .sensor-data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .sensor-item {
            background: rgba(13, 27, 42, 0.7);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .sensor-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .sensor-label {
            font-size: 0.9rem;
            color: #778da9;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-start {
            background: #4caf50;
            color: white;
        }

        .btn-stop {
            background: #f44336;
            color: white;
        }

        .btn-reset {
            background: #ff9800;
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background: #778da9;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .logs-container {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 10px;
            padding: 15px;
        }

        .log-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .log-normal {
            background: rgba(26, 42, 58, 0.8);
            border-left: 4px solid #4caf50;
        }

        .log-alert {
            background: rgba(198, 40, 40, 0.2);
            border-left: 4px solid #f44336;
        }

        .log-time {
            font-weight: bold;
        }

        .log-message {
            flex: 1;
            margin-left: 15px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(13, 27, 42, 0.7);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #778da9;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #778da9;
            font-size: 0.9rem;
            border-top: 1px solid #415a77;
        }

        /* Canvas for simulated video */
        #videoCanvas {
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Driver Drowsiness Detection System</h1>
            <p class="subtitle">Real-time monitoring for driver alertness and safety</p>
        </header>

        <div class="dashboard">
            <div class="panel">
                <h2 class="panel-title">
                    <i>ðŸ“¹</i> Live Camera Feed
                </h2>
                <div class="video-container">
                    <canvas id="videoCanvas"></canvas>
                </div>
                
                <div class="upload-section">
                    <div class="upload-tabs">
                        <div class="upload-tab active" data-tab="image">Image Analysis</div>
                        <div class="upload-tab" data-tab="video">Video Analysis</div>
                    </div>
                    
                    <div class="upload-container" id="uploadContainer">
                        <div class="upload-btn" id="uploadBtn">Upload Driver Media</div>
                        <p class="upload-text">or drag & drop a file here</p>
                        <input type="file" id="mediaInput" accept="image/*,video/*" style="display: none;">
                        <img id="uploadedImage" class="uploaded-media" alt="Uploaded driver image">
                        <video id="uploadedVideo" class="video-player" controls></video>
                        
                        <div class="video-controls" id="videoControls">
                            <button class="video-control-btn" id="playBtn">Play Analysis</button>
                            <button class="video-control-btn" id="pauseBtn">Pause</button>
                            <button class="video-control-btn" id="stopBtnVideo">Stop</button>
                        </div>
                        
                        <div class="video-analysis-progress" id="videoProgress">
                            <div class="video-progress-bar" id="videoProgressBar"></div>
                        </div>
                        
                        <div class="analysis-results" id="analysisResults">
                            <h3>Media Analysis Results</h3>
                            <div class="result-item">
                                <span class="result-label">Eye Closure:</span>
                                <span class="result-value" id="imgEyeValue">-</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Head Tilt:</span>
                                <span class="result-value" id="imgHeadValue">-</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Yawn Detected:</span>
                                <span class="result-value" id="imgYawnValue">-</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Drowsiness Level:</span>
                                <span class="result-value" id="imgDrowsiness">-</span>
                            </div>
                            <div class="result-item" id="videoDurationItem">
                                <span class="result-label">Video Duration:</span>
                                <span class="result-value" id="videoDuration">-</span>
                            </div>
                            <div class="result-item" id="drowsyEventsItem">
                                <span class="result-label">Drowsy Events:</span>
                                <span class="result-value" id="videoDrowsyEvents">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="status-indicator">
                    <div id="statusIndicator" class="status status-awake">AWAKE</div>
                </div>

                <div class="sensor-data">
                    <div class="sensor-item">
                        <div class="sensor-label">Eye Closure</div>
                        <div id="eyeValue" class="sensor-value">12%</div>
                    </div>
                    <div class="sensor-item">
                        <div class="sensor-label">Head Tilt</div>
                        <div id="headValue" class="sensor-value">3Â°</div>
                    </div>
                    <div class="sensor-item">
                        <div class="sensor-label">Blink Rate</div>
                        <div id="blinkValue" class="sensor-value">0.2/s</div>
                    </div>
                    <div class="sensor-item">
                        <div class="sensor-label">Yawn Detection</div>
                        <div id="yawnValue" class="sensor-value">No</div>
                    </div>
                </div>

                <div class="controls">
                    <button id="startBtn" class="btn-start">Start Detection</button>
                    <button id="stopBtn" class="btn-stop" disabled>Stop Detection</button>
                    <button id="resetBtn" class="btn-reset">Reset Logs</button>
                </div>
            </div>

            <div class="panel">
                <h2 class="panel-title">
                    <i>ðŸ“Š</i> System Status & Logs
                </h2>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">Detection Time</div>
                        <div id="detectionTime" class="stat-value">00:00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Drowsy Events</div>
                        <div id="drowsyEvents" class="stat-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Alert Level</div>
                        <div id="alertLevel" class="stat-value">1</div>
                    </div>
                </div>

                <h3 style="margin: 20px 0 10px;">Event Log</h3>
                <div class="logs-container" id="logsContainer">
                    <div class="log-item log-normal">
                        <div class="log-time">10:30:15</div>
                        <div class="log-message">System initialized successfully</div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Driver Drowsiness Detection System &copy; 2023 | For demonstration purposes only</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const videoCanvas = document.getElementById('videoCanvas');
        const statusIndicator = document.getElementById('statusIndicator');
        const eyeValue = document.getElementById('eyeValue');
        const headValue = document.getElementById('headValue');
        const blinkValue = document.getElementById('blinkValue');
        const yawnValue = document.getElementById('yawnValue');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const detectionTime = document.getElementById('detectionTime');
        const drowsyEvents = document.getElementById('drowsyEvents');
        const alertLevel = document.getElementById('alertLevel');
        const logsContainer = document.getElementById('logsContainer');
        const uploadContainer = document.getElementById('uploadContainer');
        const uploadBtn = document.getElementById('uploadBtn');
        const mediaInput = document.getElementById('mediaInput');
        const uploadedImage = document.getElementById('uploadedImage');
        const uploadedVideo = document.getElementById('uploadedVideo');
        const analysisResults = document.getElementById('analysisResults');
        const imgEyeValue = document.getElementById('imgEyeValue');
        const imgHeadValue = document.getElementById('imgHeadValue');
        const imgYawnValue = document.getElementById('imgYawnValue');
        const imgDrowsiness = document.getElementById('imgDrowsiness');
        const videoDuration = document.getElementById('videoDuration');
        const videoDrowsyEvents = document.getElementById('videoDrowsyEvents');
        const videoProgress = document.getElementById('videoProgress');
        const videoProgressBar = document.getElementById('videoProgressBar');
        const videoControls = document.getElementById('videoControls');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtnVideo = document.getElementById('stopBtnVideo');
        const uploadTabs = document.querySelectorAll('.upload-tab');
        const videoDurationItem = document.getElementById('videoDurationItem');
        const drowsyEventsItem = document.getElementById('drowsyEventsItem');

        // Application State
        let isDetecting = false;
        let detectionInterval;
        let startTime;
        let elapsedTime = 0;
        let eventsCount = 0;
        let currentAlertLevel = 1;
        let ctx = videoCanvas.getContext('2d');
        let currentMediaType = 'image';
        let videoAnalysisInterval;
        let isVideoAnalyzing = false;

        // Initialize canvas
        function initCanvas() {
            videoCanvas.width = videoCanvas.offsetWidth;
            videoCanvas.height = videoCanvas.offsetHeight;
            drawVideoFeed();
        }

        // Draw simulated video feed
        function drawVideoFeed() {
            if (!isDetecting) return;
            
            ctx.fillStyle = '#0d1b2a';
            ctx.fillRect(0, 0, videoCanvas.width, videoCanvas.height);
            
            // Draw face outline
            const centerX = videoCanvas.width / 2;
            const centerY = videoCanvas.height / 2;
            const faceRadius = Math.min(videoCanvas.width, videoCanvas.height) * 0.3;
            
            ctx.strokeStyle = '#415a77';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(centerX, centerY, faceRadius, 0, Math.PI * 2);
            ctx.stroke();
            
            // Draw eyes
            const eyeSpacing = faceRadius * 0.5;
            const eyeY = centerY - faceRadius * 0.2;
            const eyeRadius = faceRadius * 0.15;
            
            ctx.fillStyle = '#778da9';
            ctx.beginPath();
            ctx.arc(centerX - eyeSpacing, eyeY, eyeRadius, 0, Math.PI * 2);
            ctx.arc(centerX + eyeSpacing, eyeY, eyeRadius, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw mouth
            const mouthWidth = faceRadius * 0.6;
            const mouthHeight = faceRadius * 0.2;
            const mouthY = centerY + faceRadius * 0.3;
            
            ctx.beginPath();
            ctx.ellipse(centerX, mouthY, mouthWidth, mouthHeight, 0, 0, Math.PI);
            ctx.stroke();
            
            requestAnimationFrame(drawVideoFeed);
        }

        // Update sensor values randomly
        function updateSensorValues() {
            if (!isDetecting) return;
            
            // Simulate sensor data changes
            const eyeClosure = Math.floor(Math.random() * 30);
            const headTilt = Math.floor(Math.random() * 15);
            const blinkRate = (Math.random() * 0.5).toFixed(1);
            const isYawning = Math.random() > 0.8 ? 'Yes' : 'No';
            
            eyeValue.textContent = `${eyeClosure}%`;
            headValue.textContent = `${headTilt}Â°`;
            blinkValue.textContent = `${blinkRate}/s`;
            yawnValue.textContent = isYawning;
            
            // Randomly trigger drowsiness (5% chance each update)
            if (Math.random() < 0.05) {
                triggerDrowsiness();
            }
        }

        // Trigger drowsiness alert
        function triggerDrowsiness() {
            statusIndicator.textContent = 'DROWSY';
            statusIndicator.className = 'status status-drowsy';
            
            eventsCount++;
            drowsyEvents.textContent = eventsCount;
            
            // Increase alert level
            currentAlertLevel = Math.min(currentAlertLevel + 1, 5);
            alertLevel.textContent = currentAlertLevel;
            
            // Add log entry
            const now = new Date();
            const timeString = now.toTimeString().split(' ')[0];
            addLogEntry(timeString, 'Drowsiness detected! Alert level increased.', true);
        }

        // Reset to normal state
        function resetToNormal() {
            statusIndicator.textContent = 'AWAKE';
            statusIndicator.className = 'status status-awake';
            
            currentAlertLevel = 1;
            alertLevel.textContent = currentAlertLevel;
            
            const now = new Date();
            const timeString = now.toTimeString().split(' ')[0];
            addLogEntry(timeString, 'Driver returned to normal state.', false);
        }

        // Add log entry
        function addLogEntry(time, message, isAlert) {
            const logItem = document.createElement('div');
            logItem.className = `log-item ${isAlert ? 'log-alert' : 'log-normal'}`;
            logItem.innerHTML = `
                <div class="log-time">${time}</div>
                <div class="log-message">${message}</div>
            `;
            
            logsContainer.prepend(logItem);
            
            // Limit logs to 20 entries
            if (logsContainer.children.length > 20) {
                logsContainer.removeChild(logsContainer.lastChild);
            }
        }

        // Update detection timer
        function updateTimer() {
            if (!isDetecting) return;
            
            elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60).toString().padStart(2, '0');
            const seconds = (elapsedTime % 60).toString().padStart(2, '0');
            detectionTime.textContent = `${minutes}:${seconds}`;
        }

        // Analyze uploaded image
        function analyzeImage(image) {
            // Simulate image analysis
            const eyeClosure = Math.floor(Math.random() * 100);
            const headTilt = Math.floor(Math.random() * 30);
            const isYawning = Math.random() > 0.7 ? 'Yes' : 'No';
            
            // Determine drowsiness level
            let drowsinessLevel = 'Low';
            if (eyeClosure > 70 || headTilt > 20) {
                drowsinessLevel = 'High';
            } else if (eyeClosure > 40 || headTilt > 10) {
                drowsinessLevel = 'Medium';
            }
            
            // Update analysis results
            imgEyeValue.textContent = `${eyeClosure}%`;
            imgHeadValue.textContent = `${headTilt}Â°`;
            imgYawnValue.textContent = isYawning;
            imgDrowsiness.textContent = drowsinessLevel;
            
            // Hide video-specific elements
            videoDurationItem.style.display = 'none';
            drowsyEventsItem.style.display = 'none';
            
            // Show results
            analysisResults.style.display = 'block';
            
            // Add log entry
            const now = new Date();
            const timeString = now.toTimeString().split(' ')[0];
            addLogEntry(timeString, `Image analyzed - Drowsiness: ${drowsinessLevel}`, drowsinessLevel !== 'Low');
            
            // Trigger alert if high drowsiness
            if (drowsinessLevel === 'High') {
                triggerDrowsiness();
            }
        }

        // Analyze uploaded video
        function analyzeVideo(video) {
            // Show video-specific elements
            videoDurationItem.style.display = 'flex';
            drowsyEventsItem.style.display = 'flex';
            
            // Format duration
            const duration = Math.floor(video.duration);
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            videoDuration.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Show controls and progress
            videoControls.style.display = 'flex';
            videoProgress.style.display = 'block';
            
            // Reset progress
            videoProgressBar.style.width = '0%';
            videoDrowsyEvents.textContent = '0';
            
            // Add log entry
            const now = new Date();
            const timeString = now.toTimeString().split(' ')[0];
            addLogEntry(timeString, `Video uploaded - Duration: ${minutes}:${seconds.toString().padStart(2, '0')}`, false);
        }

        // Simulate video analysis
        function startVideoAnalysis() {
            if (isVideoAnalyzing) return;
            
            isVideoAnalyzing = true;
            let progress = 0;
            let drowsyEventsCount = 0;
            
            videoAnalysisInterval = setInterval(() => {
                progress += 2;
                videoProgressBar.style.width = `${progress}%`;
                
                // Simulate drowsiness events during analysis
                if (progress % 20 === 0 && Math.random() > 0.5) {
                    drowsyEventsCount++;
                    videoDrowsyEvents.textContent = drowsyEventsCount;
                    
                    // Update analysis results dynamically
                    const eyeClosure = Math.floor(Math.random() * 100);
                    const headTilt = Math.floor(Math.random() * 30);
                    const isYawning = Math.random() > 0.7 ? 'Yes' : 'No';
                    
                    imgEyeValue.textContent = `${eyeClosure}%`;
                    imgHeadValue.textContent = `${headTilt}Â°`;
                    imgYawnValue.textContent = isYawning;
                    
                    // Determine drowsiness level
                    let drowsinessLevel = 'Low';
                    if (eyeClosure > 70 || headTilt > 20) {
                        drowsinessLevel = 'High';
                    } else if (eyeClosure > 40 || headTilt > 10) {
                        drowsinessLevel = 'Medium';
                    }
                    
                    imgDrowsiness.textContent = drowsinessLevel;
                    
                    // Add log entry for drowsiness event
                    const now = new Date();
                    const timeString = now.toTimeString().split(' ')[0];
                    addLogEntry(timeString, `Video analysis - Drowsiness detected at ${Math.floor(progress/2)}s`, true);
                    
                    // Trigger alert if high drowsiness
                    if (drowsinessLevel === 'High') {
                        triggerDrowsiness();
                    }
                }
                
                if (progress >= 100) {
                    clearInterval(videoAnalysisInterval);
                    isVideoAnalyzing = false;
                    
                    // Add completion log
                    const now = new Date();
                    const timeString = now.toTimeString().split(' ')[0];
                    addLogEntry(timeString, `Video analysis complete - ${drowsyEventsCount} drowsy events found`, false);
                }
            }, 200);
        }

        // Stop video analysis
        function stopVideoAnalysis() {
            clearInterval(videoAnalysisInterval);
            isVideoAnalyzing = false;
            videoProgressBar.style.width = '0%';
        }

        // Handle media upload
        function handleMediaUpload(file) {
            if (!file) {
                alert('Please select a valid file.');
                return;
            }
            
            // Reset previous media
            uploadedImage.style.display = 'none';
            uploadedVideo.style.display = 'none';
            videoControls.style.display = 'none';
            videoProgress.style.display = 'none';
            analysisResults.style.display = 'none';
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                if (file.type.startsWith('image/')) {
                    // Handle image
                    currentMediaType = 'image';
                    uploadedImage.src = e.target.result;
                    uploadedImage.style.display = 'block';
                    
                    // Simulate analysis after a short delay
                    setTimeout(() => {
                        analyzeImage(uploadedImage);
                    }, 1000);
                    
                } else if (file.type.startsWith('video/')) {
                    // Handle video
                    currentMediaType = 'video';
                    uploadedVideo.src = URL.createObjectURL(file);
                    uploadedVideo.style.display = 'block';
                    
                    // Wait for video metadata to load
                    uploadedVideo.onloadedmetadata = function() {
                        analyzeVideo(uploadedVideo);
                    };
                } else {
                    alert('Please upload an image or video file.');
                }
            };
            
            reader.readAsDataURL(file);
        }

        // Switch between image and video tabs
        function switchTab(tab) {
            uploadTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // Update upload button text
            if (tab.dataset.tab === 'image') {
                uploadBtn.textContent = 'Upload Driver Image';
                mediaInput.accept = 'image/*';
            } else {
                uploadBtn.textContent = 'Upload Driver Video';
                mediaInput.accept = 'video/*';
            }
            
            // Reset media display
            uploadedImage.style.display = 'none';
            uploadedVideo.style.display = 'none';
            analysisResults.style.display = 'none';
            videoControls.style.display = 'none';
            videoProgress.style.display = 'none';
        }

        // Start detection
        function startDetection() {
            isDetecting = true;
            startBtn.disabled = true;
            stopBtn.disabled = false;
            startTime = Date.now();
            
            initCanvas();
            
            detectionInterval = setInterval(() => {
                updateSensorValues();
                updateTimer();
                
                // Randomly reset to normal state (10% chance)
                if (Math.random() < 0.1 && statusIndicator.textContent === 'DROWSY') {
                    resetToNormal();
                }
            }, 1000);
            
            const now = new Date();
            const timeString = now.toTimeString().split(' ')[0];
            addLogEntry(timeString, 'Drowsiness detection started.', false);
        }

        // Stop detection
        function stopDetection() {
            isDetecting = false;
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            clearInterval(detectionInterval);
            
            const now = new Date();
            const timeString = now.toTimeString().split(' ')[0];
            addLogEntry(timeString, 'Drowsiness detection stopped.', false);
        }

        // Reset logs and counters
        function resetLogs() {
            eventsCount = 0;
            elapsedTime = 0;
            currentAlertLevel = 1;
            
            drowsyEvents.textContent = '0';
            detectionTime.textContent = '00:00';
            alertLevel.textContent = '1';
            
            logsContainer.innerHTML = `
                <div class="log-item log-normal">
                    <div class="log-time">${new Date().toTimeString().split(' ')[0]}</div>
                    <div class="log-message">Logs reset</div>
                </div>
            `;
            
            resetToNormal();
        }

        // Event Listeners
        startBtn.addEventListener('click', startDetection);
        stopBtn.addEventListener('click', stopDetection);
        resetBtn.addEventListener('click', resetLogs);

        // Media upload event listeners
        uploadBtn.addEventListener('click', () => {
            mediaInput.click();
        });

        mediaInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleMediaUpload(e.target.files[0]);
            }
        });

        // Drag and drop functionality
        uploadContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadContainer.classList.add('drag-over');
        });

        uploadContainer.addEventListener('dragleave', () => {
            uploadContainer.classList.remove('drag-over');
        });

        uploadContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadContainer.classList.remove('drag-over');
            
            if (e.dataTransfer.files.length > 0) {
                handleMediaUpload(e.dataTransfer.files[0]);
            }
        });

        // Tab switching
        uploadTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab);
            });
        });

        // Video controls
        playBtn.addEventListener('click', startVideoAnalysis);
        pauseBtn.addEventListener('click', stopVideoAnalysis);
        stopBtnVideo.addEventListener('click', () => {
            stopVideoAnalysis();
            videoProgressBar.style.width = '0%';
            videoDrowsyEvents.textContent = '0';
        });

        // Initialize
        window.addEventListener('resize', initCanvas);
        initCanvas();
    </script>
</body>
</html>
